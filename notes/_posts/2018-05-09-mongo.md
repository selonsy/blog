---
layout: post
category: note
title: mongo
subtitle: basic usages of mongo
excerpt: A brief introduction of mongo.
time: 2018.05.09 17:44:37
tags:
- Mongo
---

### Mongo的安装
`待完成`
### Mongo中执行JS脚本
`待完成`
### 关键字的使用
#### 删除文档中存在的某个字段 ==$pull==
> `db.Table.update({query},{"$pull":"column or object"})`
#### 向指定文档插入某个字段 ==$push==
> `db.Table.update({query},{"$push":"column or object"})`
#### 查询文档中存在某个字段的记录 ==$exists==
> `db.Table.find({"column1.column2":{$exists:true}})`
#### 删除指定文档中某个字段的记录 ==$unset==
>`db.Table.update({query},{$unset:{"column1.column2":""}},{multi:true})`
#### 向指定文档中插入某个字段 ==$set==
>`db.Table.update({query},{$set:{"column1.column2":"value"}},{multi:true})`
#### 查询数组中是否包含指定的数据 ==$in== & ==$all==
>`db.Table.find({"column":{$in:["value1","value2"]}})`  
>`db.Table.find({"column":{$all:["value1","value2"]}})`  
区别:$all需要匹配所有的值

#### 文档数组内多条件匹配 ==$elemMatch==
>`db.Table.find({"column":{$elemMatch:{"column1":value1,"column2":value2}}})`

---
### 组合查询方式介绍
#### 查询最大值:
>`db.Table.find({query}).sort({"column1":-1}).limit(1)`
#### 查询最小值:
>`db.Table.find({query}).sort({"column1":1}).limit(1)`
---
### 模糊查找对比
#### SQL Server
>`select * from table where column like '%value%'`  
>`select * from table where column like 'value%'`
#### Mongo
>`db.Table.find({"column":/value/})`  
>`db.Table.find({"column":/^value/})`
---
### ObjectId相关
#### 基本解释和说明
在前面几个章节中我们已经使用了MongoDB 的对象 Id(ObjectId)。  
在本章节中，我们将了解的ObjectId的结构。  
ObjectId 是一个12字节 BSON 类型数据，有以下格式：  
- 前4个字节表示时间戳
- 接下来的3个字节是机器标识码
- 紧接的两个字节由进程id组成（PID）
- 最后三个字节是随机数

MongoDB中存储的文档必须有一个"_id"键。这个键的值可以是任何类型的，默认是个ObjectId对象。  
在一个集合里面，每个文档都有唯一的"_id"值，来确保集合里面每个文档都能被唯一标识。  
MongoDB采用ObjectId，而不是其他比较常规的做法（比如自动增加的主键）的主要原因，因为在多个 服务器上同步自动增加主键值既费力还费时。  

#### 创建新的ObjectId
使用以下代码生成新的ObjectId：
> newObjectId = ObjectId()  

上面的语句返回以下唯一生成的id：  
> ObjectId("5349b4ddd2781d08c09890f3")

你也可以使用生成的id来取代MongoDB自动生成的ObjectId：

> myObjectId = ObjectId("5349b4ddd2781d08c09890f4")

#### 创建文档的时间戳
由于ObjectId中存储了4个字节的时间戳，所以你不需要为你的文档保存时间戳字段，你可以通过`getTimestamp`函数来获取文档的创建时间:
> ObjectId("5349b4ddd2781d08c09890f4").getTimestamp()

以上代码将返回 ISO 格式的文档创建时间：
ISODate("2014-04-12T21:49:17Z")

#### ObjectId 转换为字符串
在某些情况下，您可能需要将ObjectId转换为字符串格式。你可以使用下面的代码：
> new ObjectId().str

以上代码将返回Guid格式的字符串:`5349b4ddd2781d08c09890f3`








